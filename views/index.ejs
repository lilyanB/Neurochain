<!DOCTYPE html>
<html lang="fr">
    <%- include('layouts/header'); -%>
    <body>
        <%- include('layouts/navbar'); -%>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('img/prod1.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="site-heading">
                            <h1>transaction</h1>
                            <span class="subheading">find your transaction</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Main Content-->
        <main class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <!-- Post preview-->
                    <div class="post-preview">
                        <h2 class="post-title">search by ID</h2>
                    </div>
                    <div id="Formulaire">
                        <form method="post">
                                <input type="text" name="IdTx" placeholder="ID" />
                                <testarea id="message" placeholder="Message"></testarea>
                                <input onclick="showOutput('aValue', 'ouput');" type="submit" value="envoyer" />
                        </form>
                        <script>
                            function postAjax(url, data, success) {
                                var params = typeof data == 'string' ? data : Object.keys(data).map(
                                        function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) }
                                    ).join('&');

                                var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
                                xhr.open('POST', url);
                                xhr.onreadystatechange = function() {
                                    if (xhr.readyState>3 && xhr.status==200) { success(xhr.responseText); }
                                };
                                xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                                xhr.send(params);
                                return xhr;
                            }

                            // example request
                            // postAjax('http://foo.bar/', 'p1=1&p2=Hello+World', function(data){ console.log(data); });
                            // postAjax('http://foo.bar/', { p1: 1, p2: 'Hello World' }, function(data){ console.log(data); });
                            // postAjax('http://foo.bar/', 'p1=1&p2=Hello+World', function(data){ console.log(data); });

                        </script>
                            <!-- page html ou ejs ou autre-->
                            <div id="ouput">
                            </div>
                            <script src="/js/ajaxRequester.js" type="text/javascript"></script>
                            <script>
                            function showOutput( aValue, outputDivId ) {
                                const ouputDiv = document.getElementById(outputDivId);
                                try {
                                    const url = `http://${window.location.hostname}:${window.location.port}/posts`;
                                    const data = {
                                        publicKey: aValue
                                    }
                                    postAjax(url, data, function(xhr) { 
                                        const jsonData = JSON.parse(xhr.responseText);
                                        ouputDiv.innerHTML = jsonData.balance;
                                    });
                                } catch(error) {
                                    console.log(error);
                                }
                            }
                            
                            // Controller ou Router selon ton archi
                            router.post("/posts", async function(req, res, next) {
                                var outputData = { balance: 0 };
                                const inputIdTx = req.body.IdTx;
                                // ... processing
                                res.json(outputData);
                            });
                            </script>
                    </div>
                </div>
            </div>
        </div>
        </main>
        <%- include('layouts/footer'); -%>
        <%- include('layouts/scripts'); -%>
    </body>
</html>